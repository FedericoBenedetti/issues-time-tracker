<h1> electron/angular2 issues tracking app </h1>

<div id="busy" [ngBusy]="{busy: busy,
                          message: 'Fetching data, please wait...',
                          backdrop: true,
                          delay: 200,
                          minDuration: 600}">
</div>

<kendo-dialog title="Error" *ngIf="isError" (close)="close()">
    <p style="margin: 30px; text-align: center;">Error ({{errNumber}})</p>
    <kendo-dialog-actions>
        <button kendoButton (click)="close()">Close</button>
    </kendo-dialog-actions>
</kendo-dialog>

<div id="toolbar">
    Search:
    <kendo-autocomplete [data]="projectArray" [valueField]="'name'">
    </kendo-autocomplete>

        Groups:
        <kendo-combobox [data]="comboBoxGroup" (valueChange)="valueChange($event)">
        </kendo-combobox>

        Date Start:
        <kendo-datepicker [value]="startDate" (valueChange)="onChangeStart($event)"></kendo-datepicker>
        Date End:
        <kendo-datepicker [value]="endDate" (valueChange)="onChangeEnd($event)"></kendo-datepicker>

        <button kendoButton (click)="checkAndStart()"> Fetch </button>
</div>

<kendo-grid [data]="gridData" [pageSize]="state.take" [skip]="state.skip" [sort]="state.sort" [sortable]="true" [pageable]="true"
    (dataStateChange)="dataStateChange($event)">

    <kendo-grid-column field="id" title="Project ID">
    </kendo-grid-column>
    <kendo-grid-column field="name" title="Project Name">
    </kendo-grid-column>
    <kendo-grid-column field="nActive" title="Opened Issue">
    </kendo-grid-column>
    <kendo-grid-column field="nClosed" title="Closed Issue">
    </kendo-grid-column>
    <kendo-grid-column field="timeOut" title="Issue out of time">
        <ng-template kendoGridCellTemplate let-dataItem>
            {{dataItem.timeOut}}
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column field="timeEstimated" title="Time Estimated">
        <ng-template kendoGridCellTemplate let-dataItem>
            {{dataItem.timeEstimated.h}} h
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column field="timeSpent" title="Time Spent">
        <ng-template kendoGridCellTemplate let-dataItem>
            {{dataItem.timeSpent.h}} h
        </ng-template>
    </kendo-grid-column>
    <ng-template kendoGridDetailTemplate let-dataItem [kendoGridDetailTemplateShowIf]="checkLength">
        <div *ngFor="let item of dataItem.timeOutIssue">
            <table>
                <tr>
                    <td>
                        <p id="grid-detail" style="margin-left: 1em"><strong>Name:</strong> {{item.title}}</p>
                    </td>
                    <td>
                        <p id="grid-detail"><strong>State:</strong> {{item.state}}</p>
                    </td>
                    <td>
                        <p id="grid-detail"><strong>IID:</strong> {{item.iid}}</p>
                    </td>
                    <td>
                        <p id="grid-detail"><strong>Time Estimated:</strong> {{item.time_estimate / 3600}}</p> h
                    </td>
                    <td>
                        <p id="grid-detail"><strong>Time Spent:</strong> {{item.total_time_spent / 3600}}</p> h
                    </td>
                </tr>
            </table>
        </div>
    </ng-template>
</kendo-grid>
